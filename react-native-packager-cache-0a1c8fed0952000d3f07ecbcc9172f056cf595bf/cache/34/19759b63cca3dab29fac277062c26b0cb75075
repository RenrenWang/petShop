Object.defineProperty(exports, "__esModule", {
    value: true
});
var _jsxFileName = '/Volumes/work/reactnative/petShop/js/page/Order.js';

var _react = require('react');

var _react2 = babelHelpers.interopRequireDefault(_react);

var _reactNative = require('react-native');

var _lodash = require('lodash');

var _lodash2 = babelHelpers.interopRequireDefault(_lodash);

var _config = require('../config');

var _config2 = babelHelpers.interopRequireDefault(_config);

var _StyleConfig = require('../base/StyleConfig');

var _StyleConfig2 = babelHelpers.interopRequireDefault(_StyleConfig);

var _NavBar = require('../components/NavBar');

var _NavBar2 = babelHelpers.interopRequireDefault(_NavBar);

var _Dimensions$get = _reactNative.Dimensions.get('window'),
    width = _Dimensions$get.width,
    height = _Dimensions$get.height;

var Order = function (_React$Component) {
    babelHelpers.inherits(Order, _React$Component);

    function Order(props) {
        babelHelpers.classCallCheck(this, Order);

        var _this = babelHelpers.possibleConstructorReturn(this, (Order.__proto__ || Object.getPrototypeOf(Order)).call(this, props));

        _this.placeholder = "订单留言内容";
        _this.state = {
            data: {},
            orddetData: [],
            sumRmb: 0,
            content: "",
            addreerDefault: "",
            payResult: 0
        };
        return _this;
    }

    babelHelpers.createClass(Order, [{
        key: 'componentDidMount',
        value: function componentDidMount() {
            var _this2 = this;

            this.getData();
            this.subscription = _reactNative.DeviceEventEmitter.addListener('ordeRChange', function () {
                _this2.getData();
            });
        }
    }, {
        key: 'componentWillUnmount',
        value: function componentWillUnmount() {
            this.subscription.remove();
        }
    }, {
        key: 'getData',
        value: function getData() {
            var _this3 = this;

            var prdIdsList = this.props.navigation.state.params.prdIdsList;
            var prdNumsList = this.props.navigation.state.params.prdNumsList;
            var url = this.props.navigation.state.params.NoCreacteOrder ? _config2.default.BROWERORDER + this.props.screenProps.user.pinfoId + '&ordIds=' + this.props.navigation.state.params.ordIds + '&ordCd=' + this.props.navigation.state.params.ordCd : _config2.default.ORDER + this.props.screenProps.user.pinfoId + '&prdIdsList=' + prdIdsList.join(',') + '&prdNumsList=' + prdNumsList.join(',');


            fetch(url).then(function (response) {
                return response.json();
            }).then(function (responseJson) {
                console.log(JSON.stringify(responseJson));

                var sumRmb = 0;
                responseJson.orddetData.map(function (item, index) {
                    sumRmb += item.orddetZkprice * item.orddetNums;
                });
                _this3.setState({
                    data: responseJson,
                    orddetData: responseJson.orddetData,
                    sumRmb: sumRmb
                });
            });
        }
    }, {
        key: '_pay',
        value: function _pay() {
            var _this4 = this;

            if (!this.props.screenProps.user) return _reactNative.Alert.alert('提示', '未登录，请先登录', [{ text: '确定', onPress: function onPress() {
                    return console.log('OK Pressed');
                } }], { cancelable: false });
            if (!this.state.data.addrInfo) return _reactNative.Alert.alert('提示', '未添加收货地址', [{ text: '确定', onPress: function onPress() {
                    return console.log('OK Pressed');
                } }], { cancelable: false });

            var url = "http://118.178.224.224/appsrv/callRequestAction.action?pinfoIds=" + this.props.screenProps.user.pinfoId + '&ordIds=' + this.state.orddetData[0]['ordIds'] + '&ordCd=' + this.state.data.ordCd;
            console.log(url);
            fetch(url).then(function (response) {
                return response.json();
            }).then(function (responseJson) {
                if (responseJson.result == "fail") {
                    _reactNative.Alert.alert('订单支付失败，请稍后重试');
                } else if (responseJson.result == "success") {

                    var str = "timestamp=2017-08-07+22%3A00%3A01&biz_content=%7B%22timeout_express%22%3A%2230m%22%2C%22product_code%22%3A%22QUICK_MSECURITY_PAY%22%2C%22total_amount%22%3A%220.02%22%2C%22subject%22%3A%22%E6%88%91%E7%9A%84%E8%AE%A2%E5%8D%95%22%2C%22body%22%3A%22%E6%88%91%E7%9A%84%E8%AE%A2%E5%8D%95%E5%86%85%E5%AE%B9%22%2C%22out_trade_no%22%3A%2220170725002%22%7D&sign_type=RSA2&charset=utf-8&method=alipay.trade.app.pay&app_id=2017072007829531&version=1.0&sign=WkrvzHUkqBTtL0HvMkn9Mhk3JFtnINtxm8efSEJbaOWANQY5tD6KCQeR5SkMgEX7JGX5ZERmLJdnG23JPMKAAksJvPYbnwWJyvWfdkpWlwI%2FCkHiFMooYYlxx60MFcJinpH7vI4fNy6b96JmKU8FZFErOWykk2kHeS9HJVokhZRcaF%2BZbJ2lYUxMQO6Y%2BLVE0WpGeB5fpwC%2BFI%2FAsCrUyr9yobUU7X2%2FbLMJpuWaMEKNR88bHkElYk9VoSKm%2BVjSXf1N9oFsgBBHjVSk2gYhvV%2Fpp288hdC2Sg%2FCyfLLnSjH3Am5DCvajgZ97lczbJKD7puEkQPWjjwFA%2FgqSIDyLQ%3D%3D";

                    var result = "";
                    _reactNative.NativeModules.AlipayModule.pay(responseJson.msg).then(function (resultStatus) {

                        console.log(JSON.stringify(resultStatus));
                        _this4.setState({
                            payResult: resultStatus
                        });

                        switch (JSON.stringify(resultStatus)) {
                            case "9000":
                                result = "支付成功";

                                break;
                            case "8000":
                                result = '支付结果未知,请查询订单状态';
                                break;
                            case "4000":
                                result = '订单支付失败';
                                break;
                            case "5000":
                                result = '重复请求';
                                break;
                            case "6001":
                                result = '用户中途取消';
                                break;
                            case "6002":
                                result = '网络连接出错';
                                break;
                            case "6004":
                                result = '支付结果未知,请查询订单状态';
                                break;
                            default:
                                result = '其他失败原因';
                                break;
                        }

                        _reactNative.Alert.alert('提示', result, [{ text: '确定', onPress: function onPress() {
                                return console.log('OK Pressed');
                            } }], { cancelable: false });
                    }).catch(function (err) {

                        _reactNative.Alert.alert('支付异常，请稍后重试', result, [{ text: '确定', onPress: function onPress() {
                                return console.log('OK Pressed');
                            } }], { cancelable: false });
                    });
                }
            }).catch(function (err) {
                _reactNative.Alert.alert("请求失败");
            });
        }
    }, {
        key: 'render',
        value: function render() {
            var _this5 = this;

            return _react2.default.createElement(
                _reactNative.View,
                {
                    style: { flex: 1 }, __source: {
                        fileName: _jsxFileName,
                        lineNumber: 189
                    }
                },
                _react2.default.createElement(_NavBar2.default, {
                    title: "确认订单",
                    navBarbgColor: _StyleConfig2.default.colors.mainColor,
                    navBarLeft: true,
                    navBarLeftAction: function navBarLeftAction() {
                        return _this5.props.navigation.goBack();
                    },

                    __source: {
                        fileName: _jsxFileName,
                        lineNumber: 191
                    }
                }),
                _react2.default.createElement(
                    _reactNative.ScrollView,
                    { horizontal: false, __source: {
                            fileName: _jsxFileName,
                            lineNumber: 198
                        }
                    },
                    this.state.data.addrInfo ? _react2.default.createElement(
                        _reactNative.TouchableOpacity,
                        {
                            activeOpacity: 1,
                            onPress: _lodash2.default.throttle(function () {
                                return _this5.props.navigation.navigate("ShippingAddress");
                            }, 1000, {

                                'trailing': false
                            }), style: { flexDirection: 'row', backgroundColor: '#fff', justifyContent: "space-between", alignItems: 'center', paddingHorizontal: 5, paddingVertical: 6, marginVertical: 10 }, __source: {
                                fileName: _jsxFileName,
                                lineNumber: 200
                            }
                        },
                        _react2.default.createElement(_reactNative.Image, {
                            style: { tintColor: _StyleConfig2.default.colors.SHCOlor, height: 50, width: 50 },
                            source: require('../static/images/addree.png'),
                            __source: {
                                fileName: _jsxFileName,
                                lineNumber: 206
                            }
                        }),
                        _react2.default.createElement(
                            _reactNative.View,
                            { style: { flex: 1, flexDirection: 'row', alignItems: 'center' }, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 210
                                }
                            },
                            _react2.default.createElement(
                                _reactNative.Text,
                                { style: { flex: 1, color: _StyleConfig2.default.colors.hColor, fontSize: _StyleConfig2.default.fontSize.size_14, color: _StyleConfig2.default.colors.defaultFontColor }, __source: {
                                        fileName: _jsxFileName,
                                        lineNumber: 211
                                    }
                                },
                                this.state.data.addrInfo
                            ),
                            _react2.default.createElement(_reactNative.Image, { style: { tintColor: _StyleConfig2.default.colors.SHCOlor, height: 20, width: 20 }, source: require('../static/images/rightArrow.png'), __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 212
                                }
                            })
                        )
                    ) : _react2.default.createElement(
                        _reactNative.TouchableOpacity,
                        {
                            activeOpacity: 1,
                            onPress: _lodash2.default.throttle(function () {
                                return _this5.props.navigation.navigate("AddShippingAddress");
                            }, 1000, {

                                'trailing': false
                            }), style: { flexDirection: 'row', backgroundColor: '#fff', justifyContent: "space-between", alignItems: 'center', paddingHorizontal: 5, paddingVertical: 6, marginVertical: 10 }, __source: {
                                fileName: _jsxFileName,
                                lineNumber: 214
                            }
                        },
                        _react2.default.createElement(_reactNative.Image, {
                            style: { tintColor: _StyleConfig2.default.colors.SHCOlor, height: 50, width: 50 },
                            source: require('../static/images/addree.png'),
                            __source: {
                                fileName: _jsxFileName,
                                lineNumber: 220
                            }
                        }),
                        _react2.default.createElement(
                            _reactNative.View,
                            { style: { flex: 1, flexDirection: 'row', alignItems: 'center' }, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 224
                                }
                            },
                            _react2.default.createElement(
                                _reactNative.Text,
                                { style: { flex: 1, color: _StyleConfig2.default.colors.hColor, fontSize: _StyleConfig2.default.fontSize.size_14, color: _StyleConfig2.default.colors.defaultFontColor }, __source: {
                                        fileName: _jsxFileName,
                                        lineNumber: 225
                                    }
                                },
                                '\u6DFB\u52A0\u6536\u8D27\u5730\u5740'
                            ),
                            _react2.default.createElement(_reactNative.Image, { style: { tintColor: _StyleConfig2.default.colors.SHCOlor, height: 20, width: 20 }, source: require('../static/images/rightArrow.png'), __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 226
                                }
                            })
                        )
                    ),
                    _react2.default.createElement(
                        _reactNative.View,
                        { style: { backgroundColor: '#fff' }, __source: {
                                fileName: _jsxFileName,
                                lineNumber: 230
                            }
                        },
                        _react2.default.createElement(
                            _reactNative.Text,
                            { style: { paddingHorizontal: 10, paddingVertical: 13, fontSize: _StyleConfig2.default.fontSize.size_16 }, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 231
                                }
                            },
                            '\u8D2D\u4E70\u6E05\u5355'
                        ),
                        this.state.orddetData.map(function (item, index) {
                            return _react2.default.createElement(
                                _reactNative.View,
                                { key: index, style: { paddingHorizontal: 10, paddingVertical: 10, backgroundColor: _StyleConfig2.default.colors.bgColor, alignItems: 'center', flexDirection: 'row', borderBottomWidth: 1, borderColor: "#fff" }, __source: {
                                        fileName: _jsxFileName,
                                        lineNumber: 233
                                    }
                                },
                                _react2.default.createElement(_reactNative.Image, {

                                    style: { width: 162 / 2, height: 162 / 2 }, source: { uri: _config2.default.BASEURL + item.prdUri }, __source: {
                                        fileName: _jsxFileName,
                                        lineNumber: 235
                                    }
                                }),
                                _react2.default.createElement(
                                    _reactNative.View,
                                    { style: { flex: 1, marginLeft: 8, paddingHorizontal: 5, flexDirection: 'column', justifyContent: 'space-between' }, __source: {
                                            fileName: _jsxFileName,
                                            lineNumber: 238
                                        }
                                    },
                                    _react2.default.createElement(
                                        _reactNative.View,
                                        { style: { flexDirection: 'column' }, __source: {
                                                fileName: _jsxFileName,
                                                lineNumber: 239
                                            }
                                        },
                                        _react2.default.createElement(
                                            _reactNative.View,
                                            { style: { flexDirection: 'row', justifyContent: 'space-between' }, __source: {
                                                    fileName: _jsxFileName,
                                                    lineNumber: 240
                                                }
                                            },
                                            _react2.default.createElement(
                                                _reactNative.Text,
                                                { numberOfLines: 1, style: { color: _StyleConfig2.default.colors.defaultFontColor, fontSize: _StyleConfig2.default.fontSize.size_16, marginRight: 3 }, __source: {
                                                        fileName: _jsxFileName,
                                                        lineNumber: 241
                                                    }
                                                },
                                                item.prdName
                                            ),
                                            _react2.default.createElement(
                                                _reactNative.Text,
                                                { style: { fontSize: _StyleConfig2.default.fontSize.size_16, color: _StyleConfig2.default.colors.defaultFontColor }, __source: {
                                                        fileName: _jsxFileName,
                                                        lineNumber: 242
                                                    }
                                                },
                                                '\uFFE5',
                                                item.orddetZkprice
                                            )
                                        )
                                    ),
                                    _react2.default.createElement(
                                        _reactNative.View,
                                        { style: { alignSelf: 'flex-end', marginTop: 6, flexDirection: 'row', alignItems: 'center' }, __source: {
                                                fileName: _jsxFileName,
                                                lineNumber: 247
                                            }
                                        },
                                        _react2.default.createElement(
                                            _reactNative.Text,
                                            { style: { color: _StyleConfig2.default.colors.hColor, fontSize: _StyleConfig2.default.fontSize.size_16 }, __source: {
                                                    fileName: _jsxFileName,
                                                    lineNumber: 249
                                                }
                                            },
                                            'x',
                                            item.orddetNums
                                        )
                                    )
                                )
                            );
                        })
                    ),
                    _react2.default.createElement(
                        _reactNative.View,
                        { style: { flexDirection: 'row', justifyContent: 'space-between', backgroundColor: '#fff', paddingVertical: 13, paddingHorizontal: 10, borderBottomColor: _StyleConfig2.default.colors.lineColor, borderBottomWidth: 1 }, __source: {
                                fileName: _jsxFileName,
                                lineNumber: 260
                            }
                        },
                        _react2.default.createElement(
                            _reactNative.Text,
                            { style: { fontSize: _StyleConfig2.default.fontSize.size_16 }, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 261
                                }
                            },
                            '\u5546\u54C1\u603B\u989D'
                        ),
                        _react2.default.createElement(
                            _reactNative.Text,
                            { style: { fontSize: _StyleConfig2.default.fontSize.size_14 }, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 262
                                }
                            },
                            '\uFFE5',
                            this.state.sumRmb
                        )
                    ),
                    _react2.default.createElement(
                        _reactNative.View,
                        { style: { backgroundColor: '#fff' }, __source: {
                                fileName: _jsxFileName,
                                lineNumber: 264
                            }
                        },
                        _react2.default.createElement(_reactNative.TextInput, {
                            underlineColorAndroid: 'transparent',
                            style: { height: 65, paddingHorizontal: 10, width: width, flex: 1 },
                            onChangeText: function onChangeText(content) {
                                return _this5.setState({ content: content });
                            },
                            value: this.state.content,
                            placeholder: this.placeholder,
                            placeholderTextColor: _StyleConfig2.default.colors.dText,
                            selectionColor: "#999",

                            __source: {
                                fileName: _jsxFileName,
                                lineNumber: 268
                            }
                        })
                    ),
                    _react2.default.createElement(
                        _reactNative.View,
                        { style: { backgroundColor: "#fff", marginVertical: 10 }, __source: {
                                fileName: _jsxFileName,
                                lineNumber: 279
                            }
                        },
                        _react2.default.createElement(
                            _reactNative.View,
                            { style: { borderBottomColor: _StyleConfig2.default.colors.lineColor, borderBottomWidth: 1 }, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 280
                                }
                            },
                            _react2.default.createElement(
                                _reactNative.Text,
                                { style: { paddingHorizontal: 10, paddingVertical: 13, fontSize: _StyleConfig2.default.fontSize.size_16 }, __source: {
                                        fileName: _jsxFileName,
                                        lineNumber: 281
                                    }
                                },
                                '\u652F\u4ED8\u65B9\u5F0F'
                            )
                        ),
                        _react2.default.createElement(_reactNative.Image, {
                            resizeMode: 'contain',
                            style: { height: 60, width: width },
                            source: require('../static/images/alipay.png'), __source: {
                                fileName: _jsxFileName,
                                lineNumber: 283
                            }
                        })
                    )
                ),
                _react2.default.createElement(
                    _reactNative.View,
                    { style: { backgroundColor: "#fff", flexDirection: 'row', justifyContent: 'flex-end', alignItems: 'center', height: 50, borderTopColor: _StyleConfig2.default.colors.lineColor, borderTopWidth: 1 }, __source: {
                            fileName: _jsxFileName,
                            lineNumber: 291
                        }
                    },
                    _react2.default.createElement(
                        _reactNative.View,
                        { style: { flexDirection: 'row', marginRight: 10, flex: 1, justifyContent: 'flex-end' }, __source: {
                                fileName: _jsxFileName,
                                lineNumber: 292
                            }
                        },
                        _react2.default.createElement(
                            _reactNative.Text,
                            { style: { color: _StyleConfig2.default.colors.blackColor, fontSize: _StyleConfig2.default.fontSize.size_14 }, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 293
                                }
                            },
                            '\u5B9E\u4ED8\u6B3E\uFF1A'
                        ),
                        _react2.default.createElement(
                            _reactNative.Text,
                            { style: { color: _StyleConfig2.default.colors.mainColor, fontSize: _StyleConfig2.default.fontSize.size_14 }, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 294
                                }
                            },
                            '\uFFE5',
                            this.state.sumRmb
                        )
                    ),
                    this.state.payResult == 9000 ? _react2.default.createElement(
                        _reactNative.TouchableOpacity,
                        {
                            activeOpacity: 1,

                            style: { height: 50, width: width / 4, backgroundColor: _StyleConfig2.default.colors.mainColor, alignItems: 'center', justifyContent: 'center' },
                            __source: {
                                fileName: _jsxFileName,
                                lineNumber: 296
                            }
                        },
                        _react2.default.createElement(
                            _reactNative.Text,
                            { style: { color: "#fff", fontSize: _StyleConfig2.default.fontSize.size_14 }, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 301
                                }
                            },
                            '\u8BA2\u5355\u5DF2\u652F\u4ED8'
                        )
                    ) : _react2.default.createElement(
                        _reactNative.TouchableOpacity,
                        {
                            activeOpacity: 1,
                            onPress: this._pay.bind(this),
                            style: { height: 50, width: width / 4, backgroundColor: _StyleConfig2.default.colors.mainColor, alignItems: 'center', justifyContent: 'center' },
                            __source: {
                                fileName: _jsxFileName,
                                lineNumber: 302
                            }
                        },
                        _react2.default.createElement(
                            _reactNative.Text,
                            { style: { color: "#fff", fontSize: _StyleConfig2.default.fontSize.size_14 }, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 307
                                }
                            },
                            '\u786E\u8BA4\u652F\u4ED8'
                        )
                    )
                )
            );
        }
    }]);
    return Order;
}(_react2.default.Component);

exports.default = Order;