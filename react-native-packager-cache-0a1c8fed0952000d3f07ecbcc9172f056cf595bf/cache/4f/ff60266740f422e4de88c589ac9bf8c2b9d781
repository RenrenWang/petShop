Object.defineProperty(exports, "__esModule", {
    value: true
});
var _jsxFileName = '/Volumes/work/reactnative/petShop/js/page/SetTime.js';

var _react = require('react');

var _react2 = babelHelpers.interopRequireDefault(_react);

var _reactNative = require('react-native');

var _lodash = require('lodash');

var _lodash2 = babelHelpers.interopRequireDefault(_lodash);

var _StyleConfig = require('../base/StyleConfig');

var _StyleConfig2 = babelHelpers.interopRequireDefault(_StyleConfig);

var _MyListView = require('../components/MyListView');

var _MyListView2 = babelHelpers.interopRequireDefault(_MyListView);

var _config = require('../config');

var _config2 = babelHelpers.interopRequireDefault(_config);

var _HomeHeader = require('../components/HomeHeader');

var _HomeHeader2 = babelHelpers.interopRequireDefault(_HomeHeader);

var _SetTimeItem = require('../components/SetTimeItem');

var _SetTimeItem2 = babelHelpers.interopRequireDefault(_SetTimeItem);

var _Timing = require('../components/Timing');

var _Timing2 = babelHelpers.interopRequireDefault(_Timing);

var _Loading = require('../components/Loading');

var _Loading2 = babelHelpers.interopRequireDefault(_Loading);

var _reactNativeSwiper = require('react-native-swiper');

var _reactNativeSwiper2 = babelHelpers.interopRequireDefault(_reactNativeSwiper);

var _Dimensions$get = _reactNative.Dimensions.get('window'),
    width = _Dimensions$get.width,
    height = _Dimensions$get.height;

var SpecialOffer = function (_React$Component) {
    babelHelpers.inherits(SpecialOffer, _React$Component);

    function SpecialOffer(props) {
        babelHelpers.classCallCheck(this, SpecialOffer);

        var _this = babelHelpers.possibleConstructorReturn(this, (SpecialOffer.__proto__ || Object.getPrototypeOf(SpecialOffer)).call(this, props));

        _this.state = {
            banner: [],
            swiperShow: false,
            setTimeGoods: [],
            endTime: new Date().getTime(),
            isLoading: true,
            error: "加载中..."
        };
        return _this;
    }

    babelHelpers.createClass(SpecialOffer, [{
        key: 'componentDidMount',
        value: function componentDidMount() {
            var _this2 = this;

            fetch(_config2.default.SETTIME).then(function (response) {
                return response.json();
            }).then(function (responseJson) {
                if (responseJson.result == "success") {

                    _this2.setState({
                        banner: [responseJson.lbData[0]],
                        endTime: responseJson.lbData[0]['endDate'] ? responseJson.lbData[0]['endDate'] : _this2.state.endTime,
                        setTimeGoods: responseJson.data,
                        isLoading: false
                    });
                    setTimeout(function () {
                        _this2.setState({
                            swiperShow: true
                        });
                    }, 0);
                }
            }).catch(function (err) {
                _this2.setState({
                    isLoading: true,
                    error: "网络加载失败，请稍后重试"
                });
            });
        }
    }, {
        key: 'renderSwiper',
        value: function renderSwiper() {
            var _this3 = this;

            var swiperHeight = 290 * (width / _StyleConfig2.default.pixSize);
            if (this.state.swiperShow) {
                return _react2.default.createElement(
                    _reactNativeSwiper2.default,
                    {
                        height: swiperHeight,

                        activeDotColor: _StyleConfig2.default.colors.mainColor,
                        horizontal: true,

                        removeClippedSubviews: false,
                        dotColor: 'rgba(255,255,255,0.3)',

                        paginationStyle: {
                            bottom: 6, left: 0, right: 10
                        },

                        __source: {
                            fileName: _jsxFileName,
                            lineNumber: 74
                        }
                    },
                    this.state.banner.map(function (item, index) {

                        return _react2.default.createElement(
                            _reactNative.TouchableOpacity,
                            {
                                activeOpacity: 1,
                                onPress: _lodash2.default.throttle(function () {
                                    return _this3.props.navigation.navigate("Details", { id: item.prdIds });
                                }, 1000, {

                                    'trailing': false
                                }),
                                style: {
                                    width: width,
                                    height: swiperHeight,
                                    justifyContent: 'center',
                                    backgroundColor: 'transparent'
                                },
                                key: index,
                                __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 92
                                }
                            },
                            _react2.default.createElement(_reactNative.Image, {
                                resizeMode: 'cover',
                                style: { width: width, height: swiperHeight },
                                source: { uri: _config2.default.BASEURL + item.prdNuri }, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 107
                                }
                            })
                        );
                    })
                );
            } else {
                return _react2.default.createElement(_reactNative.View, { style: { width: width, height: swiperHeight, backgroundColor: "#fff" }, __source: {
                        fileName: _jsxFileName,
                        lineNumber: 122
                    }
                });
            }
        }
    }, {
        key: 'render',
        value: function render() {
            var _this4 = this;

            return _react2.default.createElement(
                _reactNative.View,
                { style: { flex: 1, flexDirection: 'column' }, __source: {
                        fileName: _jsxFileName,
                        lineNumber: 128
                    }
                },
                !this.state.isLoading ? _react2.default.createElement(
                    _reactNative.ScrollView,
                    {
                        horizontal: false,
                        style: { flex: 1, flexDirection: 'column' }, __source: {
                            fileName: _jsxFileName,
                            lineNumber: 130
                        }
                    },
                    this.renderSwiper(),
                    _react2.default.createElement(
                        _reactNative.View,
                        { style: { backgroundColor: '#fff', flexDirection: 'row', paddingHorizontal: 10, height: 45, alignItems: 'center', justifyContent: 'space-between' }, __source: {
                                fileName: _jsxFileName,
                                lineNumber: 134
                            }
                        },
                        _react2.default.createElement(
                            _reactNative.Text,
                            { style: { color: _StyleConfig2.default.colors.blackColor, fontSize: _StyleConfig2.default.fontSize.size_16 }, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 135
                                }
                            },
                            '\u9650\u65F6\u9650\u91CF\u62A2\u8D2D\u4E2D'
                        ),
                        _react2.default.createElement(
                            _reactNative.View,
                            { style: { flexDirection: 'row', alignItems: 'center' }, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 136
                                }
                            },
                            _react2.default.createElement(
                                _reactNative.Text,
                                { style: { color: _StyleConfig2.default.colors.hColor, fontSize: _StyleConfig2.default.fontSize.size_14 }, __source: {
                                        fileName: _jsxFileName,
                                        lineNumber: 137
                                    }
                                },
                                '\u8DDD\u79BB\u7ED3\u675F'
                            ),
                            _react2.default.createElement(_Timing2.default, { endTime: this.state.endTime, mLeft: 10, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 138
                                }
                            })
                        )
                    ),
                    this.state.setTimeGoods.map(function (item, index) {

                        return _react2.default.createElement(
                            _reactNative.View,
                            { key: index, style: { flexDirection: 'column', backgroundColor: '#fff', marginTop: 10 }, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 143
                                }
                            },
                            _react2.default.createElement(_Timing2.default, { endTime: item.endDate ? item.endDate : new Date(), mTop: 5, mLeft: 10, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 143
                                }
                            }),
                            _react2.default.createElement(_SetTimeItem2.default, { item: item, key: index, navigation: _this4.props.navigation, __source: {
                                    fileName: _jsxFileName,
                                    lineNumber: 143
                                }
                            })
                        );
                    })
                ) : _react2.default.createElement(_Loading2.default, {
                    __source: {
                        fileName: _jsxFileName,
                        lineNumber: 147
                    }
                })
            );
        }
    }]);
    return SpecialOffer;
}(_react2.default.Component);

exports.default = SpecialOffer;